# Copyright 2024 davlgd <1110600+davlgd@users.noreply.github.com>
# Distributed under the terms of the GNU General Public License v2

require github [ user=astral-sh ]

SUMMARY="An extremely fast Python package installer and resolver, written in Rust"

LICENCES="|| ( Apache-2.0 MIT )"
SLOT="0"
PLATFORMS="~amd64 ~armv8"
MYOPTIONS=""

DEPENDENCIES="
    build:
        dev-lang/rust
    run:
        dev-lang/python
"

src_prepare() {
    esandbox disable_net
    edo cargo vendor
    esandbox enable_net
}

src_compile() {
    edo cargo build -rp ${PN} --frozen --offline
}

src_test() {
    edo cargo test -rp ${PN} --bins --test pip_check --frozen --offline 
}

src_install() {
    edo cargo install --path crates/${PN} --root="${IMAGE}"/usr/$(exhost --target) --frozen --offline
    emagicdocs
}
